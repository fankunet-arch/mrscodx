# MRS 物料收发管理系统 - 需求与操作手册

**文档版本**: v1.0
**编写日期**: 2025-12-16
**系统版本**: MRS v1.0
**适用对象**: 仓库管理员、操作员、业务主管

---

## 目录

1. [系统概述](#1-系统概述)
2. [业务需求说明](#2-业务需求说明)
3. [用户角色定义](#3-用户角色定义)
4. [功能操作手册](#4-功能操作手册)
5. [业务场景示例](#5-业务场景示例)
6. [常见问题解答](#6-常见问题解答)
7. [最佳实践建议](#7-最佳实践建议)
8. [附录](#8-附录)

---

## 1. 系统概述

### 1.1 系统简介

**MRS物料收发管理系统**是一个专业的仓库管理平台，帮助企业实现物料从接收、入库、库存管理到出库的全流程数字化管理。系统支持批次追踪、箱号管理、保质期预警、拆零出货等功能，确保物料管理的准确性和可追溯性。

### 1.2 系统特色

**核心优势**:
- ✅ **完整追溯**: 每个包裹从入库到出库全程记录，可随时查询历史
- ✅ **灵活出库**: 支持整箱出库和拆零出货两种模式
- ✅ **保质期管理**: 自动预警临期产品，支持FIFO/FEFO出库策略
- ✅ **多产品支持**: 单个包裹可包含多种产品，精确管理
- ✅ **统计报表**: 丰富的月度统计和用量分析功能
- ✅ **去向管理**: 灵活配置出库目的地（退回/调仓/门店）

### 1.3 与Express系统的关系

```
业务流程:

步骤1: Express系统 - 快递签收清点
       ↓ (批次清点完成)
步骤2: MRS系统 - 入库录入
       ↓ (分配箱号、记录产品明细)
步骤3: MRS系统 - 库存管理
       ↓ (查询、搜索、盘点)
步骤4: MRS系统 - 出库核销
       ↓ (整箱/拆零出库)
步骤5: MRS系统 - 统计报表
       (用量分析、月度报表)
```

**系统边界**:
- **Express负责**: 快递签收、内容清点、批次管理
- **MRS负责**: 入库登记、库存管理、出库核销、统计分析

**数据共享**:
- **共享**: 用户认证表（sys_users）
- **引用**: MRS从Express批次中导入包裹
- **独立**: 两个系统可单独迁移部署

---

## 2. 业务需求说明

### 2.1 核心业务需求

#### BR-001: 入库管理
**需求描述**: 系统需要从Express已清点批次中选择包裹进行入库，自动分配唯一箱号，支持批量入库操作。

**业务规则**:
- 只能入库Express中已清点（counted）的包裹
- 每个包裹在MRS中只能入库一次（防止重复）
- 箱号在同一批次内唯一递增
- 支持添加规格信息（可选）
- 自动记录入库时间和操作人

**验收标准**:
- ✅ 能够查看Express中所有可入库批次
- ✅ 能够选择批次查看包裹列表
- ✅ 能够批量勾选包裹并一次性入库
- ✅ 箱号自动生成且不重复
- ✅ 入库成功后无法重复入库同一快递单号

#### BR-002: 库存查询
**需求描述**: 系统提供多维度的库存查询功能，支持按产品、批次、箱号、快递单号等条件搜索，并显示库存明细。

**业务规则**:
- 库存总览按产品分组汇总（箱数、总数量、最近保质期）
- 库存明细支持FIFO、FEFO、库龄等多种排序
- 保质期临期提醒（7天内红色、30天内橙色、90天内黄色）
- 支持模糊搜索快递单号尾数（最后4位）
- 实时查询，数据与数据库同步

**验收标准**:
- ✅ 库存总览正确显示所有在库产品
- ✅ 点击产品名称能跳转到库存明细页
- ✅ 明细页支持至少5种排序方式
- ✅ 保质期颜色标记准确
- ✅ 搜索结果准确无误

#### BR-003: 整箱出库
**需求描述**: 支持选择多个包裹进行整箱出库，记录出库时间、去向和操作人。

**业务规则**:
- 只能出库状态为"在库"的包裹
- 必须选择出库去向（退回/调仓/门店）
- 出库后包裹状态变为"已出库"（shipped）
- 出库记录不可删除（仅作废）
- 自动记录到用量统计表

**验收标准**:
- ✅ 能够按物料筛选在库包裹
- ✅ 支持批量选择出库
- ✅ 能够选择或自定义出库去向
- ✅ 出库成功后包裹状态正确变更
- ✅ 用量统计表中有对应记录

#### BR-004: 拆零出货
**需求描述**: 支持从单个包裹中按数量扣减进行部分出库，包裹保持在库状态以便多次拆零。

**业务规则**:
- 只能对状态为"在库"的包裹进行拆零
- 每次拆零记录扣减数量、目的地、操作人
- 包裹保持"在库"状态，支持多次拆零
- 累计扣减量不能超过包裹总数量（提示但不强制）
- 支持自定义出库日期（可补录历史数据）

**验收标准**:
- ✅ 库存明细页面有"拆零出货"按钮
- ✅ 能够输入扣减数量和目的地
- ✅ 拆零后包裹仍为"在库"状态
- ✅ 用量统计表中有拆零记录
- ✅ 提示剩余可用数量

#### BR-005: 去向管理
**需求描述**: 提供灵活的出库去向配置，支持三大类型（退回、调仓、门店），每个类型下可创建多个具体去向。

**业务规则**:
- 去向类型固定为三种（return/warehouse/store）
- 每个具体去向归属一个类型
- 去向可配置名称、编码、联系人、电话、地址
- 去向可启用/停用（软删除）
- 出库时必须选择去向

**验收标准**:
- ✅ 去向管理页面能够查看所有去向
- ✅ 能够按类型筛选去向
- ✅ 能够新增、编辑、删除去向
- ✅ 已使用的去向不能删除
- ✅ 出库页面能够选择去向

#### BR-006: 统计报表
**需求描述**: 提供月度入库、出库统计和用量分析，支持按产品、批次、去向等维度汇总。

**业务规则**:
- 月度报表统计入库包裹数、批次数
- 月度报表统计出库次数、出库数量
- 用量分析按产品和目的地分组
- 支持导出Excel（可选功能）
- 数据准确性要求100%

**验收标准**:
- ✅ 月度报表数据与实际一致
- ✅ 能够选择月份查询历史数据
- ✅ 汇总数据准确无误
- ✅ 页面加载速度<3秒

### 2.2 非功能性需求

#### NFR-001: 性能需求
- 页面加载时间 < 3秒
- 库存查询响应时间 < 1秒
- 支持100个并发用户
- 数据库支持100万+包裹记录

#### NFR-002: 安全需求
- 所有操作需要登录认证
- 密码使用bcrypt哈希存储
- 防止SQL注入（使用PDO预处理）
- 防止XSS攻击（输出转义）
- 会话超时30分钟

#### NFR-003: 可用性需求
- 系统可用性 > 99.5%
- 数据库每日自动备份
- 操作日志保留180天
- 支持数据恢复

#### NFR-004: 兼容性需求
- 支持Chrome、Firefox、Edge浏览器
- 支持移动端浏览器访问
- 屏幕分辨率 >= 1024x768

---

## 3. 用户角色定义

### 3.1 仓库管理员（Warehouse Manager）

**职责**:
- 管理去向配置
- 审核统计报表
- 监控库存状态
- 处理异常情况

**权限**:
- ✅ 所有功能的完整访问权限
- ✅ 删除去向
- ✅ 查看所有统计报表
- ✅ 导出数据

### 3.2 仓库操作员（Warehouse Operator）

**职责**:
- 执行日常入库操作
- 执行出库和拆零出货
- 查询库存信息
- 记录操作日志

**权限**:
- ✅ 入库录入
- ✅ 出库核销
- ✅ 库存查询
- ✅ 拆零出货
- ❌ 删除去向
- ❌ 删除包裹

### 3.3 业务主管（Business Supervisor）

**职责**:
- 查看统计报表
- 分析用量趋势
- 制定库存策略
- 监督业务流程

**权限**:
- ✅ 库存查询
- ✅ 统计报表查看
- ❌ 入库/出库操作
- ❌ 修改去向配置

**注**: 当前系统版本未实现细粒度权限控制，所有登录用户拥有全部功能权限。未来版本将添加角色权限管理。

---

## 4. 功能操作手册

### 4.1 登录系统

#### 访问地址
```
生产环境: https://mrs.example.com/mrs/ap/
开发环境: http://localhost/mrs/ap/
```

#### 登录步骤

1. 打开浏览器，访问系统地址
2. 进入登录页面

   ![登录页面示意](placeholder)

3. 输入用户名和密码
   - 用户名: 系统管理员分配的登录账号
   - 密码: 初始密码（首次登录后建议修改）

4. （可选）勾选"记住我"保持登录状态

5. 点击"登录"按钮

**登录成功**: 自动跳转到库存总览页面

**登录失败**: 显示错误提示
- "用户名或密码错误" - 请检查输入
- "登录尝试次数过多" - 5分钟后重试
- "账户已停用" - 联系管理员

#### 退出登录

1. 点击页面右上角用户名
2. 选择"退出登录"
3. 自动跳转到登录页面

---

### 4.2 库存总览

#### 功能说明
库存总览页面是系统的首页，展示当前在库物料的汇总信息。

#### 页面布局

**统计卡片区域**:
```
┌────────────────────────────────────────────────────┐
│  在库包裹总数        物料种类数        当月入库    │
│      1,234个            56种            89个       │
└────────────────────────────────────────────────────┘
```

**库存汇总表格**:
| 物料名称 | 箱数 | 总数量 | 最近到期日期 |
|---------|------|--------|--------------|
| 番茄酱  | 25   | 1250   | 2026-03-15   |
| 芝麻油  | 18   | 900    | 2026-06-20   |

#### 操作说明

**查看库存明细**:
1. 在汇总表格中点击任意产品名称
2. 自动跳转到该产品的库存明细页面
3. 显示该产品所有在库包裹的详细信息

**保质期颜色标记**:
- 🔴 **红色**: 7天内到期（紧急处理）
- 🟠 **橙色**: 30天内到期（优先出库）
- 🟡 **黄色**: 90天内到期（注意库存周转）
- 🟢 **绿色**: 90天以上（正常）
- ⚫ **灰色**: 已过期（禁止出库，需处理）

**刷新数据**:
- 点击浏览器刷新按钮
- 或按F5键刷新页面

---

### 4.3 入库录入

#### 功能说明
从Express系统已清点批次中选择包裹进行入库登记，系统自动分配唯一箱号。

#### 操作步骤

**步骤1: 选择批次**

1. 导航栏点击"入库录入"
2. 页面显示所有可入库批次下拉框
3. 选择目标批次

   提示: 下拉框只显示Express中有可入库包裹的批次

**步骤2: 查看包裹列表**

页面自动加载该批次的可入库包裹:

| 选择 | 快递单号 | 内容 | 保质期 | 数量 |
|------|---------|------|--------|------|
| ☐    | SF1234567890 | 番茄酱,芝麻油 | 2026-06-15 | 100 |
| ☐    | YTO9876543210 | 芝麻油 | 2026-06-20 | 50 |

**步骤3: 选择包裹**

- **单选**: 勾选需要入库的包裹复选框
- **全选**: 点击表头"全选"复选框
- **反选**: 点击"反选"按钮

**步骤4: 填写规格信息（可选）**

在"规格备注"输入框中填写批量规格信息（如"500ml/瓶"），该信息将应用到所有选中的包裹。

**步骤5: 提交入库**

1. 确认选中的包裹
2. 点击"提交入库"按钮
3. 系统执行入库操作

**步骤6: 查看结果**

入库成功后显示:
```
✅ 入库成功
成功入库 15 个包裹
```

入库部分成功显示:
```
⚠️ 部分成功
成功入库 12 个包裹
失败 3 个:
- SF1234567890: 快递单号已入库
- YTO9876543210: 数据库错误
```

#### 注意事项

⚠️ **重要**:
- 每个快递单号在同一批次内只能入库一次
- 箱号由系统自动生成，格式为"批次前缀+4位数字"（如BAT0001）
- 入库操作不可撤销，请仔细核对
- 入库后包裹状态变为"在库"（in_stock）

#### 常见问题

**Q: 找不到要入库的批次？**
A: 确保该批次在Express系统中有已清点（counted状态）的包裹，且这些包裹尚未在MRS中入库。

**Q: 提示"快递单号已入库"？**
A: 该快递单号已在MRS系统中存在，无法重复入库。可在库存查询中搜索该单号查看详情。

**Q: 如何查看入库历史？**
A: 进入"统计报表"页面，选择对应月份查看入库明细。

---

### 4.4 出库核销

#### 功能说明
选择在库包裹进行整箱出库，记录出库时间、去向和操作人。

#### 操作步骤

**步骤1: 选择物料**

1. 导航栏点击"出库核销"
2. 在"物料选择"下拉框中选择要出库的产品
3. 页面自动加载该物料的所有在库包裹

**步骤2: 搜索和排序（可选）**

**搜索选项**:
- 物料名称（默认）
- 箱号（精确匹配）
- 快递单号尾数（模糊匹配最后几位）
- 批次名称

**排序选项**:
- FIFO（先进先出，默认）
- 到期日期（升序/降序）
- 入库时间（升序/降序）
- 库龄（升序/降序）

示例: 选择"到期日期升序"可优先显示临期产品

**步骤3: 选择去向**

在"出库去向"下拉框中选择或输入目的地:
- 退回 - 供应商退货
- 仓库调仓 - 内部调拨
- 发往门店 - 配送到门店

**步骤4: 勾选包裹**

在包裹列表中勾选要出库的包裹:

| 选择 | 快递单号 | 内容 | 箱号 | 保质期 | 数量 | 库龄 |
|------|---------|------|------|--------|------|------|
| ☐    | SF***7890 | 番茄酱 | BAT0001 | 2026-03-15 | 50 | 15天 |
| ☐    | YTO***3210 | 番茄酱 | BAT0002 | 2026-06-20 | 50 | 10天 |

**步骤5: 提交出库**

1. 确认选中的包裹和去向
2. 点击"确认出库"按钮
3. 系统弹出确认框: "确认出库 X 个包裹吗？"
4. 点击"确定"

**步骤6: 查看结果**

出库成功后显示:
```
✅ 出库成功
成功出库 5 个包裹到 [门店A]
```

#### 业务规则

**出库后的变化**:
- 包裹状态: in_stock → shipped
- 记录出库时间: 当前时间
- 记录出库去向: 选择的目的地
- 记录操作人: 当前登录用户
- 写入用量统计表

**不可出库的包裹**:
- 状态不是"在库"的包裹（已出库或已损耗）
- 已被删除的包裹

#### 注意事项

⚠️ **重要**:
- 出库操作不可撤销，请仔细核对包裹和去向
- 建议按FIFO或FEFO原则出库，优先出库库龄长或临期产品
- 出库后包裹将从库存中移除，无法再次出库
- 如需部分出库，请使用"拆零出货"功能

---

### 4.5 库存明细与拆零出货

#### 功能说明
查看某个产品的所有在库包裹详细信息，并支持拆零出货操作。

#### 访问路径
- 方式1: 库存总览 → 点击产品名称
- 方式2: 直接访问 `/mrs/ap/?action=inventory_detail&sku=产品名称`

#### 页面布局

**顶部产品信息**:
```
产品名称: 番茄酱
在库箱数: 25箱
总数量: 1250件
最近到期: 2026-03-15
```

**排序选择**:
```
[FIFO先进先出] [批次号] [到期日期↑] [到期日期↓] [库龄↑] [库龄↓]
```

**包裹明细表格**:
| 快递单号 | 批次 | 箱号 | 规格 | 保质期 | 数量 | 库龄 | 操作 |
|---------|------|------|------|--------|------|------|------|
| SF***7890 | 批次A | BAT0001 | 500ml | 2026-03-15 | 50 | 15天 | [拆零] [修改] [报损] |

#### 拆零出货操作

**使用场景**:
- 包裹数量较多，只需要出库部分数量
- 同一包裹需要分多次出库到不同目的地
- 临时调拨少量物料

**操作步骤**:

1. **点击拆零按钮**

   在目标包裹行点击"拆零"按钮

2. **填写拆零信息**

   弹出拆零出货表单:
   ```
   ┌─────────────────────────────────────┐
   │ 拆零出货                             │
   ├─────────────────────────────────────┤
   │ 快递单号: SF1234567890（只读）      │
   │ 批次: 批次A（只读）                 │
   │ 当前数量: 50                        │
   │                                     │
   │ 出货数量: [____]                    │
   │ 目的地: [____________________]      │
   │ 出库日期: [2025-12-16]              │
   │ 备注: [____________________]        │
   │                                     │
   │        [确定]  [取消]               │
   └─────────────────────────────────────┘
   ```

3. **输入出货数量**

   在"出货数量"框中输入要扣减的数量（如10）

4. **输入目的地**

   在"目的地"框中输入配送去向（如"门店A"）

5. **选择出库日期**（可选）

   默认为今天，可修改为历史日期以补录数据

6. **填写备注**（可选）

   记录拆零原因或特殊说明

7. **确认提交**

   点击"确定"按钮

**成功提示**:
```
✅ 拆零出货成功！

已从包裹中扣减 10 件
剩余 40 件
目的地: 门店A
```

#### 业务规则

**拆零后的变化**:
- 包裹状态: 保持 in_stock（仍在库）
- 记录到 mrs_usage_log 表
- 累计扣减量统计（用于计算剩余数量）
- 不改变包裹的quantity字段

**拆零限制**:
- 只能对状态为"在库"的包裹拆零
- 出货数量必须为正数
- 理论上可以超出包裹数量（系统提示但不强制限制）
- 可以对同一包裹多次拆零

#### 其他操作

**修改包裹信息**:
1. 点击"修改"按钮
2. 弹出编辑表单
3. 可修改: 规格信息、保质期、数量、仓库位置
4. 点击"保存"

**标记报损**:
1. 点击"报损"按钮
2. 填写损耗原因
3. 确认后包裹状态变为 void（损耗）
4. 包裹从库存中移除，但保留记录

---

### 4.6 去向管理

#### 功能说明
配置和管理出库目的地，支持三大类型（退回、调仓、门店）。

#### 访问路径
导航栏 → "去向管理"

#### 页面布局

**去向列表**:
| 类型 | 去向名称 | 去向编码 | 联系人 | 电话 | 状态 | 操作 |
|------|---------|---------|--------|------|------|------|
| 门店 | 门店A   | ST-001  | 张三   | 1388*** | 启用 | [编辑] [删除] |
| 调仓 | 北京仓  | WH-BJ   | 李四   | 1366*** | 启用 | [编辑] [删除] |
| 退回 | 供应商A | RT-001  | 王五   | 1399*** | 停用 | [编辑] [删除] |

#### 新增去向

**操作步骤**:

1. 点击"新增去向"按钮

2. 填写去向信息表单:
   ```
   去向类型: [发往门店 ▼]
   去向名称: [____________] *必填
   去向编码: [____________] 可选
   联系人:   [____________] 可选
   联系电话: [____________] 可选
   地址:     [____________] 可选
   备注:     [____________]
   排序:     [0]
   状态:     ○ 启用  ○ 停用

           [保存]  [取消]
   ```

3. 点击"保存"按钮

**必填字段**:
- 去向类型（三选一）
- 去向名称

**可选字段**:
- 去向编码（建议填写，便于识别）
- 联系人、电话、地址（便于配送）
- 排序（数字越小越靠前）

#### 编辑去向

1. 在去向列表中点击"编辑"按钮
2. 修改去向信息
3. 点击"保存"

#### 删除去向

1. 在去向列表中点击"删除"按钮
2. 系统检查该去向是否被使用
3. 如果已有出库记录关联该去向，无法删除（提示错误）
4. 如果未被使用，确认后删除

**提示**: 建议使用"停用"代替"删除"，避免数据丢失

#### 去向类型说明

**return（退回）**:
- 用途: 不合格产品退回供应商
- 示例: 供应商A、供应商B

**warehouse（仓库调仓）**:
- 用途: 仓库之间的物料调拨
- 示例: 北京仓、上海仓、广州仓

**store（发往门店）**:
- 用途: 配送到终端门店
- 示例: 门店A、门店B、门店C

---

### 4.7 统计报表

#### 功能说明
查看月度入库、出库统计和用量分析，支持按产品、批次、去向等维度汇总。

#### 访问路径
导航栏 → "统计报表"

#### 月份选择

页面顶部月份选择器:
```
查询月份: [2025-12 ▼]  [查询]
```

选择月份后点击"查询"按钮刷新数据。

#### 月度汇总

**汇总卡片**:
```
┌────────────────────────────────────────────────────────────────┐
│  入库包裹总数    入库批次数    出库次数    出库总数量    当前库存  │
│      125个         8个         89次        2,150件      1,234个 │
└────────────────────────────────────────────────────────────────┘
```

#### 入库明细

**按批次和产品分组**:
| 批次名称 | 产品名称 | 包裹数 | 总数量 | 首次入库时间 | 最后入库时间 |
|---------|---------|-------|--------|-------------|-------------|
| 批次A   | 番茄酱  | 25    | 1250   | 2025-12-01  | 2025-12-15  |
| 批次A   | 芝麻油  | 18    | 900    | 2025-12-01  | 2025-12-15  |
| 批次B   | 番茄酱  | 30    | 1500   | 2025-12-10  | 2025-12-10  |

#### 出库明细

**按产品和去向分组**:
| 产品名称 | 目的地 | 出库类型 | 出库次数 | 总数量 | 首次出库 | 最后出库 |
|---------|--------|---------|---------|--------|---------|---------|
| 番茄酱  | 门店A  | 拆零    | 15      | 150    | 2025-12-02 | 2025-12-15 |
| 番茄酱  | 门店B  | 整箱    | 5       | 250    | 2025-12-05 | 2025-12-10 |
| 芝麻油  | 北京仓 | 调仓    | 3       | 150    | 2025-12-08 | 2025-12-12 |

**出库类型说明**:
- **partial（拆零）**: 部分出库，包裹保持在库
- **whole（整箱）**: 整箱出库，包裹状态变为已出库

#### 数据导出（未来功能）

点击"导出Excel"按钮可将当前报表导出为Excel文件。

**注**: 当前版本暂不支持导出，计划在v2.0版本实现。

---

### 4.8 箱贴打印

#### 功能说明
打印包裹箱贴，用于物理标识和扫码管理。

#### 访问路径
导航栏 → "箱贴打印"

#### 操作步骤

1. **选择批次**

   在批次下拉框中选择目标批次

2. **输入箱号范围**

   ```
   起始箱号: [BAT0001]
   结束箱号: [BAT0010]
   ```

3. **预览箱贴**

   点击"预览"按钮查看箱贴样式

4. **打印**

   点击"打印"按钮，调用浏览器打印功能

#### 箱贴内容

标准箱贴包含以下信息:
```
┌──────────────────────────────┐
│  MRS物料管理系统              │
├──────────────────────────────┤
│  批次: 批次A                  │
│  箱号: BAT0001               │
│  内容: 番茄酱                 │
│  规格: 500ml/瓶              │
│  数量: 50                    │
│  保质期: 2026-06-15          │
│  入库时间: 2025-12-16        │
│                              │
│  [    二维码/条形码    ]     │
└──────────────────────────────┘
```

#### 打印建议

- 使用标签打印机获得最佳效果
- 建议纸张尺寸: 100mm x 150mm
- 打印后贴在包裹醒目位置
- 保持二维码/条形码清晰可扫描

---

## 5. 业务场景示例

### 场景1: 新批次物料入库

**背景**: Express系统完成了批次A的清点，包含50个包裹，现在需要在MRS中入库。

**操作流程**:

1. **准备阶段**（Express系统）
   - 操作员在Express中清点完成批次A的50个包裹
   - 所有包裹状态为"counted"
   - 产品内容、保质期已填写完整

2. **入库操作**（MRS系统）
   - 登录MRS系统
   - 点击"入库录入"
   - 选择"批次A"
   - 查看包裹列表（显示50个包裹）
   - 点击"全选"勾选所有包裹
   - 填写规格备注: "500ml/瓶"
   - 点击"提交入库"

3. **结果验证**
   - 系统提示: "成功入库 50 个包裹"
   - 自动分配箱号: BAT0001 ~ BAT0050
   - 跳转到库存总览页面
   - 确认库存中新增了批次A的物料

**预期时间**: 3-5分钟（50个包裹）

**注意事项**:
- 确保Express中已完成清点
- 核对包裹数量是否正确
- 规格备注可选，建议统一填写

---

### 场景2: 临期产品优先出库

**背景**: 门店A需要番茄酱100件，库存中有多个批次的番茄酱，需要优先出库临期产品。

**操作流程**:

1. **查询库存**
   - 登录MRS系统
   - 点击"出库核销"
   - 选择物料: "番茄酱"

2. **临期排序**
   - 选择排序方式: "到期日期（升序）"
   - 页面自动按保质期从早到晚排序

3. **查看保质期**
   - 第1个包裹: 2026-03-15（红色，紧急）
   - 第2个包裹: 2026-04-20（橙色，优先）
   - 第3个包裹: 2026-06-30（黄色，注意）

4. **选择包裹**
   - 从前往后勾选包裹，直到数量达到100件
   - 假设勾选了前5个包裹（总计120件）

5. **出库操作**
   - 选择去向: "门店A"
   - 点击"确认出库"
   - 系统提示: "成功出库 5 个包裹到 门店A"

**预期结果**:
- 优先出库了临期产品
- 减少库存损耗风险
- 保证门店收到的产品保质期较长

**最佳实践**:
- 日常出库优先使用FEFO（先到期先出）
- 每周检查库存总览的保质期颜色标记
- 红色和橙色产品尽快安排出库

---

### 场景3: 大包装拆零配送

**背景**: 仓库收到一箱番茄酱（50瓶），需要分多次配送到不同门店。

**操作流程**:

**第一次拆零**（门店A需要10瓶）:

1. 进入"库存明细"页面
2. 找到该包裹（快递单号: SF1234567890）
3. 点击"拆零"按钮
4. 填写信息:
   - 出货数量: 10
   - 目的地: 门店A
   - 出库日期: 2025-12-16
5. 确认提交
6. 系统提示: "拆零成功，剩余40件"

**第二次拆零**（门店B需要15瓶）:

1. 同一包裹再次点击"拆零"
2. 填写信息:
   - 出货数量: 15
   - 目的地: 门店B
   - 出库日期: 2025-12-17
3. 确认提交
4. 系统提示: "拆零成功，剩余25件"

**第三次拆零**（门店C需要25瓶，全部出完）:

1. 同一包裹再次点击"拆零"
2. 填写信息:
   - 出货数量: 25
   - 目的地: 门店C
   - 出库日期: 2025-12-18
3. 确认提交
4. 系统提示: "拆零成功，剩余0件"

**统计查询**:

进入"统计报表"页面，查看出库明细:
| 产品名称 | 目的地 | 出库类型 | 总数量 | 出库时间 |
|---------|--------|---------|--------|---------|
| 番茄酱  | 门店A  | 拆零    | 10     | 2025-12-16 |
| 番茄酱  | 门店B  | 拆零    | 15     | 2025-12-17 |
| 番茄酱  | 门店C  | 拆零    | 25     | 2025-12-18 |

**优点**:
- 包裹保持在库状态，支持多次拆零
- 每次拆零都有完整记录
- 支持不同日期、不同去向
- 自动统计累计出货量

---

### 场景4: 月度库存盘点

**背景**: 每月底需要对库存进行盘点，核对账面数据与实际库存。

**准备工作**:

1. **导出库存报表**
   - 登录MRS系统
   - 进入"库存总览"
   - 记录所有产品的箱数和数量

2. **打印箱贴清单**（可选）
   - 进入"箱贴打印"
   - 按批次打印所有在库包裹的箱贴
   - 用于现场扫码盘点

**盘点流程**:

1. **实物盘点**
   - 仓库人员按货架逐个清点实物
   - 扫描箱贴二维码记录
   - 记录实际数量

2. **数据核对**
   - 将实物盘点结果与MRS系统对比
   - 找出差异（盈亏）

3. **差异处理**
   - 盘盈: 在MRS中补录入库（如果确认是漏录）
   - 盘亏: 在MRS中标记损耗（填写原因）

4. **生成盘点报告**
   - 进入"统计报表"
   - 选择盘点月份
   - 导出入库、出库、库存数据
   - 形成盘点报告提交主管

**差异调整**:

如果发现包裹实际已损耗但系统中仍为"在库":

1. 进入"库存明细"页面
2. 找到该包裹
3. 点击"报损"按钮
4. 填写损耗原因: "盘点发现破损"
5. 确认后包裹状态变为 void

**建议频率**:
- 月度盘点: 每月最后一天
- 季度盘点: 每季度末
- 年度盘点: 每年12月31日

---

## 6. 常见问题解答

### 6.1 登录与权限

**Q1: 忘记密码怎么办？**

A: 联系系统管理员重置密码。当前版本不支持用户自助重置密码。

**Q2: 登录后立即跳转回登录页？**

A: 可能原因：
- 会话超时（30分钟无操作）
- 浏览器禁用了Cookie
- 系统维护中

解决方法：
1. 清除浏览器缓存和Cookie
2. 检查浏览器Cookie设置（必须启用）
3. 更换浏览器尝试（推荐Chrome）

**Q3: 提示"登录尝试次数过多"？**

A: 5次登录失败后锁定5分钟，请等待后重试或联系管理员。

---

### 6.2 入库问题

**Q4: 找不到要入库的批次？**

A: 可能原因：
- 该批次在Express中尚未清点完成
- 该批次的包裹已全部在MRS中入库
- 批次状态为"closed"（已关闭）

解决方法：
1. 返回Express系统检查批次状态
2. 确保至少有一个包裹状态为"counted"
3. 确认包裹未在MRS中重复入库

**Q5: 提示"快递单号已入库"？**

A: 该快递单号已在MRS系统中存在，可能原因：
- 之前已经入库过
- 不同批次有相同快递单号（不允许）

解决方法：
1. 在"库存总览"搜索该快递单号
2. 确认是否确实已入库
3. 如果是错误，联系管理员删除重复记录

**Q6: 箱号重复怎么办？**

A: 箱号由系统自动生成，理论上不会重复。如果出现重复：
1. 检查数据库完整性
2. 联系技术人员修复索引
3. 重新执行入库操作

---

### 6.3 出库问题

**Q7: 找不到要出库的包裹？**

A: 可能原因：
- 包裹未入库（在Express中但不在MRS中）
- 包裹已出库（状态为shipped）
- 包裹已损耗（状态为void）
- 搜索条件不匹配

解决方法：
1. 确认包裹已入库（检查快递单号）
2. 在"库存总览"查看该产品是否有库存
3. 调整搜索关键词或排序方式

**Q8: 误操作出库了，可以撤销吗？**

A: 当前版本不支持出库撤销。建议流程：
1. 立即通知主管
2. 如果包裹尚未发出，可以：
   - 联系技术人员在数据库中恢复（需修改status为in_stock）
   - 或在物料返回后重新入库

**Q9: 拆零出货超出了包裹数量怎么办？**

A: 系统会提示但不强制限制。如果确实超出：
1. 检查包裹实际数量
2. 修改包裹quantity字段
3. 或在下次拆零时填写负数调整

---

### 6.4 库存查询

**Q10: 库存数据不准确？**

A: 可能原因：
- 未刷新页面
- 有其他用户正在操作
- 数据库同步延迟

解决方法：
1. 按F5刷新页面
2. 检查是否有其他用户同时操作
3. 如果仍不准确，联系管理员检查数据

**Q11: 搜索快递单号搜不到？**

A: 可能原因：
- 快递单号输入错误
- 包裹已出库或损耗
- 搜索类型选择错误

解决方法：
1. 确认快递单号准确无误
2. 选择"快递单号尾数"搜索类型（仅输入最后4-6位）
3. 在"统计报表"中查询历史数据

**Q12: 保质期颜色标记是什么意思？**

A:
- 🔴 红色: 7天内到期，紧急处理
- 🟠 橙色: 30天内到期，优先出库
- 🟡 黄色: 90天内到期，注意周转
- 🟢 绿色: 90天以上，正常
- ⚫ 灰色: 已过期，禁止出库

---

### 6.5 统计报表

**Q13: 月度报表数据与实际不符？**

A: 可能原因：
- 查询月份选择错误
- 有些操作的日期填写错误
- 数据计算错误

解决方法：
1. 确认查询月份正确
2. 检查用量统计表中的created_at字段
3. 联系技术人员检查SQL查询逻辑

**Q14: 如何导出报表数据？**

A: 当前版本暂不支持导出功能。临时方案：
- 复制页面数据粘贴到Excel
- 或联系技术人员直接从数据库导出

---

## 7. 最佳实践建议

### 7.1 日常操作

**入库时机**:
- 建议每天固定时间入库（如上午10:00）
- Express清点完成后及时入库，避免积压
- 批量入库前仔细核对包裹数量

**出库原则**:
- 优先采用FIFO（先进先出）或FEFO（先到期先出）
- 每天检查库存总览的保质期颜色标记
- 红色和橙色产品优先安排出库

**拆零管理**:
- 大包装产品建议使用拆零功能
- 每次拆零填写详细的目的地和备注
- 定期检查拆零包裹的累计出货量

**数据维护**:
- 每月底进行库存盘点
- 及时标记损耗和过期产品
- 保持去向列表的准确性和及时性

### 7.2 性能优化

**浏览器选择**:
- 推荐使用Chrome、Firefox、Edge最新版本
- 避免使用IE浏览器

**操作习惯**:
- 及时退出登录，避免会话占用
- 避免同时打开多个系统页面
- 大批量操作（>100个包裹）分批进行

**网络环境**:
- 确保稳定的网络连接
- 重要操作前检查网络状态
- 出现错误及时刷新页面重试

### 7.3 数据安全

**密码管理**:
- 初次登录后立即修改密码
- 密码长度至少8位，包含字母和数字
- 不与他人共享账号

**操作规范**:
- 操作前仔细核对数据
- 重要操作（出库、删除）需二次确认
- 发现错误及时报告主管

**日志查看**:
- 系统记录所有操作日志
- 管理员可查看logs/mrs/debug.log
- 异常操作会记录到error.log

### 7.4 应急处理

**系统无法访问**:
1. 检查网络连接
2. 清除浏览器缓存
3. 联系IT技术支持

**数据错误**:
1. 立即停止操作
2. 截图记录错误信息
3. 联系管理员处理

**紧急出库**:
1. 优先处理临期产品
2. 记录紧急出库原因
3. 事后补充完整信息

---

## 8. 附录

### 附录A: 快捷键

| 快捷键 | 功能 |
|--------|------|
| F5 | 刷新当前页面 |
| Ctrl+F | 页面内查找 |
| Tab | 跳转到下一个输入框 |
| Enter | 提交表单（部分页面） |
| Esc | 关闭模态框 |

### 附录B: 浏览器兼容性

| 浏览器 | 最低版本 | 推荐版本 | 备注 |
|--------|---------|---------|------|
| Chrome | 80+ | 最新版 | ✅ 推荐 |
| Firefox | 75+ | 最新版 | ✅ 推荐 |
| Edge | 88+ | 最新版 | ✅ 推荐 |
| Safari | 13+ | 最新版 | ⚠️ 部分功能 |
| IE | - | - | ❌ 不支持 |

### 附录C: 系统限制

| 项目 | 限制 |
|------|------|
| 单次入库包裹数 | 建议<100个 |
| 单次出库包裹数 | 建议<50个 |
| 产品名称长度 | <200字符 |
| 备注长度 | <65535字符 |
| 会话超时时间 | 30分钟 |
| 登录失败限制 | 5次/5分钟 |

### 附录D: 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 包裹台账 | Package Ledger | MRS系统的核心表，记录所有包裹信息 |
| 箱号 | Box Number | 系统自动分配的唯一标识，格式如BAT0001 |
| FIFO | First In First Out | 先进先出，库存管理原则 |
| FEFO | First Expire First Out | 先到期先出，保质期管理原则 |
| 拆零出货 | Partial Outbound | 从包裹中按数量部分出库 |
| 整箱出库 | Whole Outbound | 整个包裹一次性出库 |
| SKU | Stock Keeping Unit | 库存保存单位，产品编码 |

### 附录E: 联系支持

**技术支持**:
- 邮箱: support@example.com
- 电话: 400-XXX-XXXX
- 工作时间: 周一至周五 9:00-18:00

**紧急联系**:
- 7x24小时热线: 138-XXXX-XXXX
- 紧急邮箱: emergency@example.com

**文档反馈**:
- 如有文档错误或建议，请发送至: docs@example.com

---

**文档结束**

**版本历史**:
- v1.0 (2025-12-16): 初始版本发布
