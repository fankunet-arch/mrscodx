# 通用物品接收清点系统 - 需求与操作手册

**系统名称**: Generic Package Reception & Count System (GPRCS)
**原名称**: Express快递签收清点系统
**文档版本**: v1.0
**编写日期**: 2025-12-16
**系统版本**: GPRCS v1.0
**适用对象**: 仓库管理员、操作员、业务主管

---

## 目录

1. [系统概述](#1-系统概述)
2. [业务需求说明](#2-业务需求说明)
3. [用户角色定义](#3-用户角色定义)
4. [功能操作手册](#4-功能操作手册)
5. [业务场景示例](#5-业务场景示例)
6. [常见问题解答](#6-常见问题解答)
7. [最佳实践建议](#7-最佳实践建议)
8. [附录](#8-附录)

---

## 1. 系统概述

### 1.1 系统简介

**通用物品接收清点系统（GPRCS）**是一个专业的仓库收货管理平台，帮助企业实现物品的签收、核实、清点和内容记录的全流程数字化管理。系统支持批次管理、快速操作、多产品明细、保质期管理等功能，确保收货流程的准确性和可追溯性。

**系统更名说明**:
- **原名称**: Express快递签收清点系统
- **新名称**: 通用物品接收清点系统
- **更名原因**: 系统不限于快递包裹，可处理任何需要清点的物品，"通用物品"更准确地描述了系统的适用范围

### 1.2 系统特色

**核心优势**:
- ✅ **快速操作**: 前台页面支持手机/平板，扫码清点，0延迟反馈
- ✅ **完整追溯**: 记录核实人、清点人、调整人及时间戳
- ✅ **多产品支持**: 单个包裹可包含多种产品，精确管理
- ✅ **灵活导入**: 支持批量导入快递单号、创建自定义包裹
- ✅ **智能辅助**: 产品保质期自动建议功能

### 1.3 与MRS系统的关系

```
业务流程:

步骤1: 通用物品接收清点系统（本系统）
       - 创建批次
       - 导入快递单号
       - 前台快速清点（核实/清点/调整）
       - 记录产品内容、数量、保质期
       ↓
步骤2: MRS物料收发管理系统
       - 从本系统的已清点批次导入包裹
       - 库存管理
       - 出库核销
       - 统计分析
```

**数据共享**:
- **共享**: 用户认证表（sys_users）
- **数据流向**: 本系统 → MRS系统（单向）
- **独立性**: 两系统可独立迁移部署

---

## 2. 业务需求说明

### 2.1 核心业务需求

#### BR-001: 批次管理
**需求描述**: 系统需要支持创建批次、编辑批次、关闭批次等操作，每个批次包含多个包裹。

**业务规则**:
- 批次名称必须唯一
- 批次有两种状态：active（活动中）、closed（已关闭）
- 批次统计字段自动维护（total_count、verified_count、counted_count、adjusted_count）
- 删除批次会级联删除所有关联包裹、产品明细、操作日志

**验收标准**:
- ✅ 能够创建新批次并自动生成批次ID
- ✅ 批次名称重复时提示错误
- ✅ 能够编辑批次名称、备注、状态
- ✅ 删除批次时弹出确认框
- ✅ 批次统计数据实时更新

#### BR-002: 包裹导入
**需求描述**: 支持批量导入快递单号到指定批次，支持带保质期和数量的格式。

**业务规则**:
- 支持纯单号导入：每行一个快递单号
- 支持带数据导入：单号|保质期|数量（使用竖线分隔）
- 保质期格式：YYYY-MM-DD
- 重复单号自动跳过（不报错）
- 保质期格式错误跳过该行（记录错误）

**验收标准**:
- ✅ 能够批量导入100+快递单号
- ✅ 导入结果显示成功数、重复数、错误数
- ✅ 重复单号不影响其他单号导入
- ✅ 导入完成后批次统计更新

#### BR-003: 自定义包裹创建
**需求描述**: 为一个快递箱创建多个逻辑包裹，用于拆分记录多个产品。

**业务规则**:
- 自定义包裹编号格式：CUSTOM-{batch_id}-{序号}
- 序号自动递增，4位数字补零（如0001, 0002）
- 初始状态为 pending
- 需要手工清点填写内容

**验收标准**:
- ✅ 能够一次创建多个自定义包裹
- ✅ 编号自动递增且不重复
- ✅ 创建成功后显示包裹列表

#### BR-004: 核实操作
**需求描述**: 确认包裹存在，记录核实时间和操作人。

**业务规则**:
- 只能核实 pending 状态的包裹
- 核实后状态变为 verified
- 记录 verified_at 和 verified_by
- 不需要填写内容信息

**验收标准**:
- ✅ 前台页面能选择"核实"操作
- ✅ 输入快递单号后显示包裹信息
- ✅ 确认核实后状态变为 verified
- ✅ 批次统计中 verified_count 增加

#### BR-005: 清点操作
**需求描述**: 记录包裹内容、数量、保质期等详细信息，支持多产品明细。

**业务规则**:
- 可清点 pending 或 verified 状态的包裹
- 必填: 内容备注（content_note）
- 可选: 保质期、数量、产品明细
- 清点后状态变为 counted
- 记录 counted_at 和 counted_by
- 支持单个包裹多个产品（express_package_items表）
- 自动填充 verified_at（如果之前未核实）

**验收标准**:
- ✅ 前台页面能选择"清点"操作
- ✅ 能够输入内容备注
- ✅ 能够添加多个产品项（产品名称、数量、保质期）
- ✅ 清点成功后状态变为 counted
- ✅ 批次统计中 counted_count 增加
- ✅ 产品明细保存到 express_package_items 表

#### BR-006: 调整操作
**需求描述**: 修正清点结果，记录调整原因。

**业务规则**:
- 只能调整 counted 或 adjusted 状态的包裹
- 必填: 调整备注（adjustment_note）
- 调整后状态变为 adjusted
- 记录 adjusted_at 和 adjusted_by
- 可以多次调整

**验收标准**:
- ✅ 前台页面能选择"调整"操作
- ✅ 必须填写调整备注
- ✅ 调整成功后状态变为 adjusted
- ✅ 批次统计中 adjusted_count 增加

#### BR-007: 快速搜索
**需求描述**: 在前台快速操作页面支持模糊搜索快递单号，实时反馈匹配结果。

**业务规则**:
- 搜索防抖（0.5秒）
- 模糊匹配快递单号
- 限制返回20条结果
- 显示包裹状态、内容备注、产品明细
- 搜索结果缓存到前端Map

**验收标准**:
- ✅ 输入快递单号后0.5秒自动搜索
- ✅ 显示匹配的包裹列表
- ✅ 点击搜索结果自动填充表单
- ✅ 搜索结果包含产品明细

#### BR-008: 操作历史
**需求描述**: 显示当前批次的最近操作记录，支持按操作类型筛选。

**业务规则**:
- 显示最近100条操作
- 按操作类型筛选（核实/清点/调整）
- 按快递单号去重（同一单号只显示最新操作）
- 显示快递单号、操作类型、操作时间、操作人、新状态

**验收标准**:
- ✅ 操作历史实时更新
- ✅ 能够按操作类型筛选
- ✅ 去重逻辑正确

#### BR-009: 保质期建议
**需求描述**: 在清点时自动建议该批次中该产品最常用的保质期。

**业务规则**:
- 查询该批次中该产品的所有保质期
- 按使用次数降序排序
- 返回使用次数最多的保质期
- 前台自动填充到保质期输入框

**验收标准**:
- ✅ 输入产品名称后自动查询保质期建议
- ✅ 建议的保质期准确
- ✅ 无建议时不影响手工输入

#### BR-010: 内容搜索
**需求描述**: 【后台功能】跨批次搜索包裹内容备注。

**业务规则**:
- 跨所有批次搜索
- 模糊匹配 content_note
- 去重显示（DISTINCT）
- 限制返回50条
- 显示内容、快递单号、批次名称、清点时间

**验收标准**:
- ✅ 能够搜索到所有匹配的内容
- ✅ 搜索结果去重
- ✅ 显示关联信息完整

### 2.2 非功能性需求

#### NFR-001: 性能需求
- 页面加载时间 < 2秒
- 搜索响应时间 < 1秒
- 支持50个并发用户
- 数据库支持10万+包裹记录

#### NFR-002: 安全需求
- 所有操作需要登录认证
- 密码使用bcrypt哈希存储
- 防止SQL注入（使用PDO预处理）
- 防止XSS攻击（输出转义）
- 会话超时30分钟

#### NFR-003: 可用性需求
- 系统可用性 > 99%
- 数据库每日自动备份
- 操作日志保留180天
- 支持数据恢复

#### NFR-004: 兼容性需求
- 支持Chrome、Firefox、Edge浏览器
- **重点支持移动端浏览器**（前台快速操作页面）
- 前台页面最小分辨率 375x667（iPhone SE）
- 后台页面最小分辨率 1024x768

---

## 3. 用户角色定义

### 3.1 仓库操作员（Warehouse Operator）

**职责**:
- 使用前台快速操作页面
- 执行核实、清点、调整操作
- 扫码录入快递单号
- 填写产品内容和保质期

**使用设备**:
- 手机、平板（优先）
- PC（备用）

**权限**:
- ✅ 访问前台快速操作页面
- ✅ 核实、清点、调整包裹
- ✅ 查看操作历史
- ❌ 创建/删除批次
- ❌ 批量导入

**注**: 当前系统版本未实现细粒度权限控制，所有登录用户拥有全部功能权限。

### 3.2 仓库管理员（Warehouse Manager）

**职责**:
- 使用后台管理页面
- 创建和管理批次
- 批量导入快递单号
- 查询和分析数据
- 处理异常情况

**使用设备**:
- PC、笔记本

**权限**:
- ✅ 所有前台功能
- ✅ 所有后台功能
- ✅ 创建/编辑/删除批次
- ✅ 批量导入快递单号
- ✅ 创建自定义包裹
- ✅ 更新包裹内容
- ✅ 内容搜索

### 3.3 业务主管（Business Supervisor）

**职责**:
- 监督清点进度
- 查看批次统计
- 分析清点数据
- 制定业务流程

**使用设备**:
- PC、笔记本

**权限**:
- ✅ 查看批次列表和详情
- ✅ 查看批次统计
- ✅ 内容搜索
- ❌ 操作包裹
- ❌ 修改批次

**注**: 当前系统版本未实现细粒度权限控制。

---

## 4. 功能操作手册

### 4.1 登录系统

#### 访问地址
```
前台（快速操作）: https://example.com/express/
后台（管理页面）: https://example.com/express/exp/
```

#### 登录步骤

1. 打开浏览器，访问系统地址
2. 进入登录页面
3. 输入用户名和密码
   - 用户名: 系统管理员分配的登录账号
   - 密码: 初始密码
4. 【可选】勾选"记住我"
5. 点击"登录"按钮

**登录成功**:
- 前台：跳转到快速操作页面
- 后台：跳转到批次列表页面

**登录失败**:
- "用户名或密码错误" - 请检查输入
- "登录尝试次数过多，请5分钟后再试" - 防暴力破解锁定
- "账户已停用" - 联系管理员

#### 退出登录

1. 点击页面右上角用户名
2. 选择"退出登录"
3. 自动跳转到登录页面

---

### 4.2 【后台】批次管理

#### 4.2.1 创建批次

**访问路径**: 后台首页 → "创建批次"按钮

**操作步骤**:

1. 点击"创建批次"按钮

2. 填写批次信息:
   ```
   批次名称: [2025-12-16批次A]  *必填
   备注:     [供应商A发货]       可选

            [保存]  [取消]
   ```

3. 点击"保存"按钮

**成功提示**:
```
✅ 批次创建成功
批次ID: 5
批次名称: 2025-12-16批次A
```

**注意事项**:
- ⚠️ 批次名称必须唯一，重复会提示错误
- ⚠️ 创建后批次状态默认为 active（活动中）
- ⚠️ 创建后初始统计为：总数0、已核实0、已清点0、已调整0

#### 4.2.2 查看批次列表

**访问路径**: 后台首页（默认页面）

**页面布局**:

| 批次ID | 批次名称 | 状态 | 总数 | 已核实 | 已清点 | 已调整 | 创建时间 | 操作 |
|--------|---------|------|------|--------|--------|--------|---------|------|
| 5 | 2025-12-16批次A | 活动中 | 50 | 30 | 25 | 2 | 2025-12-16 10:00 | [详情] [编辑] [删除] |

**状态标识**:
- **活动中**（绿色）: status = active
- **已关闭**（灰色）: status = closed

**统计进度条**:
- 已核实进度: verified_count / total_count
- 已清点进度: counted_count / total_count
- 已调整数量: adjusted_count

#### 4.2.3 批次详情

**访问路径**: 批次列表 → 点击"详情"按钮

**页面内容**:

**1. 批次信息卡片**:
```
批次名称: 2025-12-16批次A
批次状态: 活动中
创建时间: 2025-12-16 10:00
创建人:   admin
备注:     供应商A发货
```

**2. 统计信息**:
```
┌────────────────────────────────────────────┐
│  总包裹数     已核实     已清点     已调整  │
│    50个       30个       25个       2个    │
└────────────────────────────────────────────┘
```

**3. 包裹列表**:

| 快递单号 | 状态 | 内容备注 | 保质期 | 数量 | 核实人 | 清点人 | 操作 |
|---------|------|---------|--------|------|--------|--------|------|
| SF***7890 | 已清点 | 番茄酱,芝麻油 | 2026-06-15 | 100 | admin | admin | [详情] |

**4. 内容概括**（去重统计）:
```
番茄酱,芝麻油  15个
番茄酱        10个
芝麻油         8个
```

**5. 操作按钮**:
- [批量导入] - 跳转到批量导入页面
- [创建自定义包裹] - 弹出创建表单
- [前往前台清点] - 跳转到前台快速操作页面

#### 4.2.4 编辑批次

**访问路径**: 批次列表 → 点击"编辑"按钮

**可编辑字段**:
```
批次名称: [2025-12-16批次A]
状态:     ○ 活动中  ○ 已关闭
备注:     [供应商A发货]

         [保存]  [取消]
```

**业务规则**:
- 可修改批次名称（需保证唯一）
- 可修改批次状态（active ↔ closed）
- 可修改备注
- 不可修改创建时间、创建人

#### 4.2.5 删除批次

**访问路径**: 批次列表 → 点击"删除"按钮

**确认对话框**:
```
⚠️ 警告

确认删除批次"2025-12-16批次A"吗？

此操作将同时删除：
- 该批次的所有包裹（50个）
- 所有产品明细
- 所有操作日志

此操作不可恢复！

       [取消]  [确认删除]
```

**注意事项**:
- ⚠️ 删除批次会级联删除所有关联数据
- ⚠️ 操作不可撤销，请谨慎操作
- ⚠️ 建议使用"关闭批次"代替"删除批次"

---

### 4.3 【后台】包裹导入

#### 4.3.1 批量导入快递单号

**访问路径**: 批次详情 → "批量导入"按钮

**操作步骤**:

1. 在批次详情页点击"批量导入"按钮

2. 进入批量导入页面

3. 填写快递单号（支持三种格式）:

   **格式一：纯单号**
   ```
   SF1234567890
   YTO9876543210
   JD1122334455
   ```

   **格式二：单号+保质期**
   ```
   SF1234567890|2026-06-15
   YTO9876543210|2026-06-20
   ```

   **格式三：单号+保质期+数量**
   ```
   SF1234567890|2026-06-15|100
   YTO9876543210|2026-06-20|50
   JD1122334455||75
   ```

   **格式说明**:
   - 每行一个快递单号
   - 使用竖线 `|` 分隔
   - 保质期格式: YYYY-MM-DD
   - 数量为整数
   - 保质期和数量可选，留空使用两个竖线 `||`

4. 点击"开始导入"按钮

**导入结果**:
```
✅ 导入完成

成功导入: 45 个
重复跳过: 3 个
格式错误: 2 个

错误详情:
- SF123错误单号: 保质期格式错误
- YTO456错误单号: 数据库错误
```

**业务规则**:
- 重复单号自动跳过（不报错，计入重复数）
- 保质期格式错误跳过该行（记入错误）
- 其他错误跳过该行（记入错误）
- 导入成功后批次统计自动更新

#### 4.3.2 创建自定义包裹

**使用场景**:
- 一个快递箱包含多个不同产品，需要分开记录
- 快递单号不够用时

**访问路径**: 批次详情 → "创建自定义包裹"按钮

**操作步骤**:

1. 点击"创建自定义包裹"按钮

2. 填写创建数量:
   ```
   批次: 2025-12-16批次A (ID: 5)

   创建数量: [____]

   说明: 将创建编号为 CUSTOM-5-0001 至 CUSTOM-5-00XX 的包裹

          [确定]  [取消]
   ```

3. 输入数量（如10）

4. 点击"确定"

**成功提示**:
```
✅ 创建成功

成功创建 10 个自定义包裹:
- CUSTOM-5-0001
- CUSTOM-5-0002
- ...
- CUSTOM-5-0010

这些包裹的初始状态为"待处理"，请前往前台清点页面进行清点。
```

**编号规则**:
- 格式: `CUSTOM-{batch_id}-{序号}`
- 序号自动递增，4位数字补零
- 例: CUSTOM-5-0001, CUSTOM-5-0002, ...

---

### 4.4 【前台】快速操作

#### 4.4.1 前台页面介绍

**访问路径**: https://example.com/express/

**页面布局**（移动优先设计）:

```
┌────────────────────────────────────────┐
│  通用物品接收清点系统                   │
├────────────────────────────────────────┤
│  步骤1: 选择批次                        │
│  [2025-12-16批次A ▼]                   │
│                                        │
│  批次统计:                              │
│  总数: 50  已核实: 30  已清点: 25      │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  清点进度: 50%                         │
│                                        │
│  步骤2: 选择操作类型                    │
│  [   核实   ] [   清点   ] [   调整   ]│
│                                        │
│  步骤3: 输入快递单号                    │
│  [___________________________]         │
│                                        │
│  步骤4: 填写内容信息（清点操作时显示）   │
│  内容备注: [________________]          │
│  保质期:   [2026-06-15]               │
│  数量:     [100]                      │
│                                        │
│  产品明细:                              │
│  [+ 添加产品项]                        │
│                                        │
│  [     提交     ]                      │
│                                        │
│  最近操作历史:                          │
│  ┌──────────────────────────────┐    │
│  │ SF***7890  清点  10:30  admin │    │
│  │ YTO***3210 核实  10:25  admin │    │
│  └──────────────────────────────┘    │
└────────────────────────────────────────┘
```

**设计特点**:
- 大按钮（最小60px高度）
- 大输入框（最小44px高度）
- 清晰的步骤提示
- 实时反馈
- 支持扫码枪输入

#### 4.4.2 核实操作

**使用场景**: 快速确认包裹存在，不需要填写详细内容

**操作步骤**:

1. **选择批次**: 从下拉框选择目标批次

2. **选择操作**: 点击"核实"按钮（按钮变蓝色表示选中）

3. **输入单号**:
   - 扫描快递单号（推荐）
   - 或手工输入快递单号

4. **实时搜索**:
   - 输入0.5秒后自动搜索
   - 显示匹配的包裹列表
   - 点击匹配结果自动填充

5. **提交**: 点击"提交"按钮

**成功提示**:
```
✅ 核实成功
快递单号: SF1234567890
状态: 待处理 → 已核实
```

**界面变化**:
- 表单自动清空
- 焦点回到单号输入框
- 操作历史新增一条记录
- 批次统计更新（已核实数+1）
- 进度条更新

#### 4.4.3 清点操作

**使用场景**: 记录包裹详细内容、数量、保质期

**操作步骤**:

1. **选择批次**: 从下拉框选择目标批次

2. **选择操作**: 点击"清点"按钮

3. **输入单号**: 扫描或输入快递单号

4. **填写内容**（清点时必填）:

   **基本信息**:
   ```
   快递单号: SF1234567890 （自动填充）
   批次:     2025-12-16批次A （自动显示）

   内容备注: [番茄酱,芝麻油]  *必填
   保质期:   [2026-06-15]     可选
   数量:     [100]            可选
   ```

   **产品明细**（可选，支持多产品）:
   ```
   产品1:
   - 产品名称: [番茄酱]
   - 数量:     [50]
   - 保质期:   [2026-06-15]
   [删除]

   产品2:
   - 产品名称: [芝麻油]
   - 数量:     [50]
   - 保质期:   [2026-06-15]
   [删除]

   [+ 添加产品项]
   ```

5. **智能辅助**（自动功能）:
   - 输入产品名称后，自动查询该批次中该产品最常用的保质期
   - 自动填充到保质期输入框
   - 可手工修改

6. **快捷功能**:
   - **应用上次清点**: 点击按钮，自动填充上次清点的内容
   - 适用于连续清点相同产品

7. **提交**: 点击"提交"按钮

**成功提示**:
```
✅ 清点成功

快递单号: SF1234567890
内容: 番茄酱,芝麻油
产品明细: 2个产品
状态: 待处理 → 已清点
```

**数据保存位置**:
- express_package表: content_note、expiry_date、quantity、package_status='counted'
- express_package_items表: 产品明细（如果填写）
- express_operation_log表: 操作日志

#### 4.4.4 调整操作

**使用场景**: 修正清点结果，记录调整原因

**前置条件**: 包裹必须是 counted 或 adjusted 状态

**操作步骤**:

1. **选择批次**: 从下拉框选择目标批次

2. **选择操作**: 点击"调整"按钮

3. **输入单号**: 扫描或输入快递单号

4. **填写调整信息**:
   ```
   快递单号: SF1234567890 （自动填充）
   批次:     2025-12-16批次A （自动显示）
   当前状态: 已清点

   调整备注: [____________________]  *必填
   （例: 数量有误，应为80）
   ```

5. **提交**: 点击"提交"按钮

**成功提示**:
```
✅ 调整成功

快递单号: SF1234567890
调整原因: 数量有误，应为80
状态: 已清点 → 已调整
```

**注意事项**:
- ⚠️ 只能调整已清点或已调整的包裹
- ⚠️ 必须填写调整原因
- ⚠️ 可以多次调整

#### 4.4.5 操作历史

**位置**: 前台快速操作页面底部

**显示内容**:
```
最近操作历史 (最多显示100条)

筛选: [全部 ▼]  (可选: 全部/核实/清点/调整)

┌────────────────────────────────────────┐
│ SF***7890  清点  10:30  admin         │
│ YTO***3210 核实  10:25  admin         │
│ JD***4455  调整  10:20  admin         │
│ ...                                    │
└────────────────────────────────────────┘
```

**业务规则**:
- 显示当前批次的最近100条操作
- 按操作时间倒序排列
- 按快递单号去重（同一单号只显示最新操作）
- 支持按操作类型筛选

**刷新时机**:
- 页面加载时
- 提交操作后
- 切换批次后

---

### 4.5 【后台】内容搜索

#### 功能说明
跨所有批次搜索包裹内容备注，用于快速查找特定物品的清点记录。

#### 访问路径
后台导航栏 → "物品搜索"

#### 操作步骤

1. 进入物品搜索页面

2. 输入搜索关键词:
   ```
   搜索关键词: [番茄酱]  [搜索]
   ```

3. 点击"搜索"按钮

4. 查看搜索结果:

   | 内容备注 | 快递单号 | 批次名称 | 清点时间 |
   |---------|---------|---------|---------|
   | 番茄酱,芝麻油 | SF***7890 | 2025-12-16批次A | 2025-12-16 10:30 |
   | 番茄酱 | YTO***3210 | 2025-12-15批次B | 2025-12-15 15:20 |

**搜索特点**:
- 跨所有批次搜索
- 模糊匹配内容备注
- 去重显示（相同内容只显示一次）
- 限制返回50条

---

### 4.6 【后台】更新包裹内容

#### 功能说明
在后台修改已清点包裹的内容信息。

#### 访问路径
批次详情 → 包裹列表 → 点击"详情" → "编辑内容"按钮

#### 操作步骤

1. 在批次详情页找到目标包裹

2. 点击"详情"查看包裹信息

3. 点击"编辑内容"按钮

4. 修改信息:
   ```
   内容备注: [番茄酱,芝麻油,辣椒酱]
   保质期:   [2026-06-15]
   数量:     [120]

   产品明细:
   [同清点操作的产品明细表单]

          [保存]  [取消]
   ```

5. 点击"保存"

**成功提示**:
```
✅ 更新成功
包裹内容已更新
状态自动变为: 已清点
```

**业务规则**:
- 更新后包裹状态自动变为 counted
- 覆盖式保存产品明细
- 记录到操作日志

---

### 4.7 【后台】查看包裹产品明细

#### 功能说明
查看包裹的详细产品列表（如果清点时填写了产品明细）。

#### 访问路径
- 方式1: 批次详情 → 包裹列表 → 点击"详情"
- 方式2: API调用 `/express/exp/?action=get_package_items&package_id=123`

#### 显示内容

**包裹基本信息**:
```
快递单号: SF1234567890
批次: 2025-12-16批次A
状态: 已清点
内容备注: 番茄酱,芝麻油
清点时间: 2025-12-16 10:30
清点人: admin
```

**产品明细列表**:

| 序号 | 产品名称 | 数量 | 保质期 |
|------|---------|------|--------|
| 1 | 番茄酱 | 50 | 2026-06-15 |
| 2 | 芝麻油 | 50 | 2026-06-15 |

**说明**:
- 如果清点时未填写产品明细，此部分为空
- 产品明细按 sort_order 排序
- 数据来源: express_package_items 表

---

## 5. 业务场景示例

### 场景1: 新批次快递清点

**背景**: 仓库收到供应商A的50个快递包裹，需要清点入库。

**操作流程**:

**步骤1: 创建批次**（后台管理员操作）

1. 登录后台管理页面
2. 点击"创建批次"
3. 填写:
   - 批次名称: 2025-12-16供应商A
   - 备注: 番茄酱和芝麻油
4. 保存（批次ID: 5）

**步骤2: 导入快递单号**（后台管理员操作）

1. 进入批次详情页（批次5）
2. 点击"批量导入"
3. 粘贴50个快递单号（从Excel复制）
4. 开始导入
5. 结果: 成功导入50个，重复0个，错误0个

**步骤3: 前台清点**（仓库操作员操作）

操作员拿着手机，逐个扫描清点：

1. 打开前台快速操作页面（手机浏览器）
2. 选择批次: 2025-12-16供应商A
3. 选择操作: 清点
4. 扫描第1个包裹（SF1234567890）
5. 自动搜索并匹配
6. 填写:
   - 内容备注: 番茄酱
   - 保质期: 2026-06-15
   - 数量: 50
7. 提交（1/50完成）
8. 扫描第2个包裹...
9. ...
10. 扫描第50个包裹，完成

**步骤4: 验收**（管理员检查）

1. 进入批次详情页
2. 查看统计:
   - 总数: 50
   - 已清点: 50
   - 清点进度: 100%
3. 查看内容概括:
   - 番茄酱: 30个
   - 芝麻油: 20个
4. 确认完成

**预期时间**: 约30-40分钟（50个包裹）

---

### 场景2: 一个快递箱多个产品

**背景**: 一个快递箱包含3种不同产品，需要分别记录。

**方案A: 使用产品明细**

1. 扫描快递单号: SF1234567890
2. 选择操作: 清点
3. 填写内容备注: 番茄酱,芝麻油,辣椒酱
4. 添加产品明细:
   - 产品1: 番茄酱, 数量30, 保质期2026-06-15
   - 产品2: 芝麻油, 数量40, 保质期2026-06-20
   - 产品3: 辣椒酱, 数量30, 保质期2026-07-01
5. 提交

**优点**:
- 一个包裹记录，完整保存所有产品信息
- 产品明细分别记录，便于后续MRS系统统计

**方案B: 创建自定义包裹**

1. 后台创建3个自定义包裹:
   - CUSTOM-5-0001
   - CUSTOM-5-0002
   - CUSTOM-5-0003

2. 前台分别清点:
   - CUSTOM-5-0001: 番茄酱, 30, 2026-06-15
   - CUSTOM-5-0002: 芝麻油, 40, 2026-06-20
   - CUSTOM-5-0003: 辣椒酱, 30, 2026-07-01

**优点**:
- 每个产品独立包裹记录
- 便于后续MRS系统单独管理

**【建议】**: 优先使用方案A（产品明细），除非需要完全独立管理每个产品。

---

### 场景3: 快速核实大批量包裹

**背景**: 仓库收到100个快递，需要快速确认都到了，但暂时没时间清点内容。

**操作流程**:

1. 后台创建批次: 2025-12-16快速核实批次
2. 批量导入100个快递单号
3. 前台选择操作: **核实**（不是清点）
4. 快速扫描100个包裹（每个约3秒）
5. 完成核实，状态全部变为 verified

**后续操作**:
- 有时间时再逐个清点（verified → counted）
- 或直接在MRS系统中入库（MRS支持从verified状态的包裹入库）

**预期时间**: 约5-10分钟（100个包裹核实）

---

### 场景4: 清点错误需要调整

**背景**: 操作员清点时将数量填错了，需要调整。

**操作流程**:

1. 前台选择操作: 调整
2. 扫描快递单号: SF1234567890
3. 当前信息自动显示:
   - 内容: 番茄酱
   - 数量: 100（错误）
   - 保质期: 2026-06-15
4. 填写调整备注: "数量有误，实际为80"
5. 提交

**后续处理**:
- 状态变为 adjusted
- 后台管理员在批次详情中看到调整记录
- 管理员点击"编辑内容"修改数量为80
- 保存后状态回到 counted

**注意**:
- 调整操作只记录调整原因，不直接修改数据
- 实际修改需要后台管理员在"编辑内容"中操作

---

## 6. 常见问题解答

### 6.1 批次管理

**Q1: 批次名称可以重复吗？**

A: 不可以。批次名称在数据库中有唯一约束，重复创建会提示"批次名称已存在"。

**Q2: 删除批次会删除什么数据？**

A: 删除批次会级联删除：
- 该批次的所有包裹（express_package）
- 所有产品明细（express_package_items）
- 所有操作日志（express_operation_log）

**建议**: 使用"关闭批次"代替"删除批次"，保留历史数据。

**Q3: 批次关闭后还能清点吗？**

A: 可以。批次状态（active/closed）不影响包裹操作，只是标识批次的业务状态。

---

### 6.2 包裹导入

**Q4: 批量导入时单号格式错误怎么办？**

A: 系统会跳过格式错误的行，并在导入结果中显示错误详情。建议检查错误行并重新导入。

**Q5: 导入时提示"重复单号"是什么意思？**

A: 该快递单号在该批次中已存在。系统会自动跳过重复单号，计入"重复数"，不影响其他单号导入。

**Q6: 保质期格式是什么？**

A: YYYY-MM-DD（如2026-06-15）。其他格式（如2026/06/15、06-15-2026）会被识别为错误。

---

### 6.3 前台操作

**Q7: 前台搜索为什么有延迟？**

A: 系统使用0.5秒防抖，避免频繁搜索。输入停顿0.5秒后自动搜索。

**Q8: 搜索不到快递单号怎么办？**

A: 可能原因：
- 单号未导入到该批次
- 批次选择错误
- 单号输入错误

解决方法：
1. 检查批次选择是否正确
2. 检查单号是否完整
3. 后台批次详情中查询该单号是否存在

**Q9: "应用上次清点"功能是什么？**

A: 点击此按钮，系统会自动填充上次清点的内容备注和产品明细，适用于连续清点相同产品。

**Q10: 清点时必须填写产品明细吗？**

A: 不必须。产品明细是可选的。可以只填写内容备注，不填写产品明细。

---

### 6.4 数据查询

**Q11: 如何查看某个包裹的操作历史？**

A: 【未实现】当前版本不支持查看单个包裹的完整操作历史。可查看：
- 前台操作历史（最近100条，去重）
- express_operation_log表（需数据库查询）

**【计划功能】**: 未来版本将在包裹详情页显示完整操作历史。

**Q12: 如何统计某个产品的总数量？**

A: 【未实现】当前版本不支持直接统计。可通过：
- 后台"内容搜索"查找该产品的所有包裹
- 手工累加数量

**【建议】**: 使用MRS系统的库存统计功能，支持按产品自动汇总。

---

### 6.5 系统异常

**Q13: 提交操作时提示"网络错误"？**

A: 可能原因：
- 网络断开
- 服务器故障
- 会话超时

解决方法：
1. 检查网络连接
2. 刷新页面重新登录
3. 联系管理员检查服务器

**Q14: 批次统计数据不正确？**

A: 批次统计由系统自动维护。如果发现不准确：
1. 刷新页面
2. 联系管理员手工触发统计更新
3. 检查数据库 express_update_batch_statistics() 函数

---

## 7. 最佳实践建议

### 7.1 批次命名规范

**【建议】** 采用统一的批次命名规范，便于管理和查询：

**格式建议**:
```
{日期}-{供应商/来源}-{类型}

示例:
- 2025-12-16-供应商A-食品
- 2025-12-16-供应商B-日用品
- 2025-12-16-退货-门店A
```

**好处**:
- 一目了然知道批次来源
- 便于搜索和筛选
- 避免名称冲突

### 7.2 清点效率提升

**【建议】** 连续清点相同产品时：

1. **使用"应用上次清点"功能**
   - 第一个包裹完整填写
   - 后续包裹点击"应用上次清点"
   - 仅修改不同的字段（如数量、保质期）

2. **产品保质期建议**
   - 输入产品名称后等待0.5秒
   - 系统自动填充最常用的保质期
   - 减少手工输入

3. **扫码枪配置**
   - 设置扫码后自动回车
   - 减少手动点击

**预期提升**: 清点速度提升30-50%

### 7.3 错误处理流程

**【建议】** 发现清点错误时的处理流程：

1. **立即停止当前操作**
2. **使用"调整"功能标记**
   - 填写详细的调整原因
   - 通知主管
3. **主管后台审核**
   - 查看调整备注
   - 在后台"编辑内容"中修正数据
4. **记录到业务日志**（可选）

### 7.4 批次生命周期管理

**【建议】** 批次的完整生命周期：

```
创建批次 → 导入单号 → 清点 → 关闭批次 → MRS入库 → 归档
   ↓         ↓        ↓       ↓         ↓        ↓
 active    pending  counted  closed   in_stock  历史
```

**阶段说明**:
1. **创建批次**: 状态设为 active
2. **导入单号**: 包裹状态为 pending
3. **清点**: 包裹状态变为 counted
4. **关闭批次**: 清点完成后，批次状态改为 closed
5. **MRS入库**: MRS系统从closed批次导入
6. **归档**: 【未实现】定期归档历史批次

**注意**: 批次关闭后仍可继续操作包裹，closed只是业务标识。

### 7.5 移动端使用技巧

**【建议】** 前台移动端操作技巧：

1. **横屏使用**
   - 输入框更大
   - 显示更多信息

2. **使用外接扫码枪**
   - 提升扫码速度
   - 减少手工输入错误

3. **保持屏幕常亮**
   - 避免频繁解锁
   - 提高连续操作效率

4. **使用WiFi**
   - 避免移动数据不稳定
   - 提升响应速度

### 7.6 数据安全建议

**【建议】** 确保数据安全：

1. **定期备份**
   - 数据库每日自动备份
   - 重要批次手工导出

2. **权限控制**（【未实现】）
   - 当前版本所有用户权限相同
   - 【计划功能】未来版本添加角色权限

3. **操作规范**
   - 删除批次前二次确认
   - 重要操作截图留证

4. **日志保留**
   - 操作日志保留180天
   - 定期归档历史数据

---

## 8. 附录

### 附录A: 包裹状态流转图

```
pending (待处理)
   ↓
   ├─→ verified (已核实)
   │      ↓
   └─────→ counted (已清点)
             ↓
          adjusted (已调整)
             ↓
          adjusted (可多次调整)
```

**状态说明**:
- **pending**: 导入后的初始状态，等待处理
- **verified**: 已确认包裹存在，但未记录内容
- **counted**: 已记录包裹内容、数量、保质期
- **adjusted**: 已修正清点结果，记录调整原因

**状态转换规则**:
- pending → verified（核实操作）
- pending → counted（清点操作，跳过核实）
- verified → counted（清点操作）
- counted → adjusted（调整操作）
- adjusted → adjusted（再次调整）

### 附录B: 数据库表关系

```
express_batch (批次表)
    ↓ 1:N
express_package (包裹表)
    ↓ 1:N
    ├─→ express_package_items (产品明细表)
    └─→ express_operation_log (操作日志表)
```

**级联删除**:
- 删除批次 → 删除所有包裹 → 删除所有产品明细 + 删除所有操作日志

**外键约束**:
```sql
express_package.batch_id → express_batch.batch_id (CASCADE)
express_package_items.package_id → express_package.package_id (CASCADE)
express_operation_log.package_id → express_package.package_id (CASCADE)
```

### 附录C: 快捷键

| 快捷键 | 功能 | 适用页面 |
|--------|------|---------|
| F5 | 刷新页面 | 所有 |
| Ctrl+F | 页面内查找 | 所有 |
| Tab | 跳转到下一个输入框 | 所有 |
| Enter | 提交表单 | 前台快速操作 |
| Esc | 关闭模态框 | 所有 |

### 附录D: 浏览器兼容性

| 浏览器 | 最低版本 | 推荐版本 | 备注 |
|--------|---------|---------|------|
| Chrome | 80+ | 最新版 | ✅ 强烈推荐（移动端） |
| Firefox | 75+ | 最新版 | ✅ 推荐 |
| Edge | 88+ | 最新版 | ✅ 推荐 |
| Safari | 13+ | 最新版 | ✅ iOS推荐 |
| 微信浏览器 | - | 最新版 | ⚠️ 部分功能 |
| IE | - | - | ❌ 不支持 |

### 附录E: 系统限制

| 项目 | 限制 | 说明 |
|------|------|------|
| 单次批量导入 | 建议<1000行 | 超过可能导致超时 |
| 自定义包裹创建 | 建议<100个 | 一次创建太多影响性能 |
| 批次名称长度 | <100字符 | 数据库字段限制 |
| 内容备注长度 | <65535字符 | TEXT字段 |
| 产品名称长度 | <200字符 | 数据库字段限制 |
| 会话超时时间 | 30分钟 | 无操作自动登出 |
| 登录失败限制 | 5次/5分钟 | 防暴力破解 |
| 搜索结果限制 | 20条（前台）<br>50条（后台） | 性能考虑 |
| 操作历史显示 | 100条 | 前台页面限制 |

### 附录F: 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 批次 | Batch | 一组包裹的集合，用于组织管理 |
| 包裹 | Package | 单个快递包裹或逻辑包裹 |
| 核实 | Verify | 确认包裹存在，不记录内容 |
| 清点 | Count | 记录包裹内容、数量、保质期 |
| 调整 | Adjust | 修正清点结果，记录调整原因 |
| 产品明细 | Package Items | 包裹内包含的多个产品的详细信息 |
| 自定义包裹 | Custom Package | 系统生成的逻辑包裹，编号格式CUSTOM-X-XXXX |
| 保质期建议 | Expiry Suggestion | 根据历史数据自动建议保质期 |

### 附录G: 功能实现状态标记说明

本手册使用以下标记区分功能实现状态：

- **无标记**: 已实现功能，可正常使用
- **【未实现】**: 当前版本未实现的功能
- **【计划功能】**: 规划在未来版本实现的功能
- **【建议】**: 最佳实践建议，非系统功能

**示例**:
- "批次创建" - 已实现
- "【未实现】单个包裹操作历史" - 未实现
- "【计划功能】角色权限控制" - 计划功能
- "【建议】批次命名规范" - 建议

### 附录H: 联系支持

**技术支持**:
- 【待补充】邮箱地址
- 【待补充】电话号码
- 【待补充】工作时间

**紧急联系**:
- 【待补充】7x24小时热线
- 【待补充】紧急邮箱

**文档反馈**:
- 如有文档错误或建议，请联系技术支持

---

**文档结束**

**版本历史**:
- v1.0 (2025-12-16): 初始版本发布，系统更名为"通用物品接收清点系统"

**功能完整性说明**:
本手册基于系统当前实际代码编写，所有未实现功能均已明确标记。使用前请注意区分已实现和计划功能。
